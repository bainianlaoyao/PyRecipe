"""
完整菜谱示例 - 展示框架的完整功能
"""

import sys
import os

sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from 菜谱框架 import *


# ============================================================================
# 辅助菜谱
# ============================================================================

@定义菜谱("炒土豆")
def 炒土豆(菜: 菜谱构建器):
    """简单炒土豆"""
    土豆块 = 菜.切(菜.取食材("土豆", 克(500)), "块")
    蒜 = 菜.取食材("蒜", 克(5))
    油1 = 菜.取食材("油", 克(5))
    油2 = 菜.取食材("油", 克(20))
    盐 = 菜.取食材("盐", 克(3))

    # 炒蒜
    蒜香 = 菜.炒([蒜], 时间_秒=10, 描述="爆香", 用油=5)

    # 炒土豆
    炒土豆_ = 菜.炒([土豆块], 时间_秒=30, 用油=15)

    # 加盐
    最终 = 菜.调味([炒土豆_], ["盐"], "炒土豆")

    return 最终


@定义菜谱("黑暗炖土豆")
def 黑暗炖土豆(菜: 菜谱构建器):
    """
    黑暗炖土豆 - 复用炒土豆作为前置菜品
    展示菜谱的复用性
    """
    # 引用已定义的菜谱
    炒土豆_ = 菜.引用("炒土豆")

    # 炖制
    炖土豆 = 菜.炖([炒土豆_], 时间_秒=120, 名称="黑暗炖土豆")

    return 炖土豆


# ============================================================================
# 复杂菜谱 - 宫保鸡丁
# ============================================================================

@定义菜谱("宫保鸡丁")
def 宫保鸡丁(菜: 菜谱构建器):
    """
    宫保鸡丁 - 复杂菜谱示例
    """
    # 准备主料
    鸡胸肉 = 菜.取食材("鸡胸肉", 克(300))
    鸡丁 = 菜.切(鸡胸肉, "丁")

    花生 = 菜.取食材("花生", 克(50))
    干辣椒 = 菜.切(菜.取食材("干辣椒", 个(10)), "段")

    # 准备调料
    料酒 = 菜.取食材("料酒", 毫升(15))
    生抽 = 菜.取食材("生抽", 毫升(10))
    淀粉 = 菜.取食材("淀粉", 克(5))

    # 腌制鸡肉
    腌制鸡丁 = 菜.自定义(
        [鸡丁],
        "用料酒、生抽、淀粉腌制15分钟",
        "腌制鸡丁"
    )

    # 炒制
    主菜 = 菜.炒(
        [腌制鸡丁, 干辣椒, 花生],
        时间_秒=120,
        描述="大火爆炒",
        名称="宫保鸡丁"
    )

    # 调味
    最终 = 菜.调味(
        [主菜],
        ["糖", "醋", "盐"],
        "宫保鸡丁"
    )

    return 最终


# ============================================================================
# 复杂菜谱 - 意大利肉酱面
# ============================================================================

@定义菜谱("意大利肉酱")
def 意大利肉酱(菜: 菜谱构建器):
    """意大利肉酱"""
    芹菜段 = 菜.切(菜.取食材("芹菜", 根(1)), "段")
    猪肉碎 = 菜.切(菜.取食材("猪肉", 克(600)), "碎")
    洋葱丁 = 菜.切(菜.取食材("洋葱", 个(1)), "碎")
    番茄酱 = 菜.取食材("番茄酱", 克(100))

    肉酱 = 菜.混合(
        [芹菜段, 猪肉碎, 洋葱丁, 番茄酱],
        "混合，下锅翻炒一分钟",
        "意大利肉酱"
    )

    return 肉酱


@定义菜谱("意大利肉酱面")
def 意大利肉酱面(菜: 菜谱构建器):
    """意大利肉酱面 - 多层复用"""
    # 煮面条
    面条 = 菜.取食材("意大利面", 克(200))
    煮熟的面条 = 菜.炖([面条], 时间_秒=600, 名称="煮熟的意大利面")

    # 肉酱
    肉酱 = 菜.引用("意大利肉酱")

    # 组合
    最终 = 菜.组合(
        [煮熟的面条, 肉酱],
        "拌匀",
        "意大利肉酱面"
    )

    return 最终


# ============================================================================
# 展示不同风格
# ============================================================================

def 展示装饰器风格():
    """展示装饰器风格"""
    print("\n" + "=" * 60)
    print("装饰器风格 - 宫保鸡丁")
    print("=" * 60)

    处理器 = Markdown输出器()
    宫保鸡丁(处理器)

    print("\n烹饪步骤:")
    print(处理器.输出())


def 展示上下文风格():
    """展示上下文管理器风格"""
    print("\n" + "=" * 60)
    print("上下文管理器风格 - 意大利肉酱面")
    print("=" * 60)

    markdown_处理器 = Markdown输出器()
    stats_处理器 = 统计分析器()

    with 菜谱上下文(组合处理器([markdown_处理器, stats_处理器])) as 菜:
        # 定义肉酱
        芹菜段 = 菜.切(菜.取食材("芹菜", 根(1)), "段")
        猪肉碎 = 菜.切(菜.取食材("猪肉", 克(600)), "碎")
        洋葱丁 = 菜.切(菜.取食材("洋葱", 个(1)), "碎")
        番茄酱 = 菜.取食材("番茄酱", 克(100))

        肉酱 = 菜.混合(
            [芹菜段, 猪肉碎, 洋葱丁, 番茄酱],
            "混合，下锅翻炒一分钟",
            "意大利肉酱"
        )

        # 煮面条
        面条 = 菜.取食材("意大利面", 克(200))
        煮熟的面条 = 菜.炖([面条], 时间_秒=600, 名称="煮熟的意大利面")

        # 组合
        菜.组合([煮熟的面条, 肉酱], "拌匀", "意大利肉酱面")

    print("\n烹饪步骤:")
    print(markdown_处理器.输出())

    print("\n" + stats_处理器.输出())


def 展示操作符风格():
    """展示操作符重载风格"""
    print("\n" + "=" * 60)
    print("操作符重载风格 - 黑暗炖土豆")
    print("=" * 60)

    处理器 = Markdown输出器()
    菜 = 菜谱构建器(处理器)

    # 准备食材
    土豆块 = 菜["土豆", 克(500)] >> 切("块")
    蒜 = 菜["蒜", 克(5)]
    油 = 菜["油", 克(25)]
    盐 = 菜["盐", 克(3)]

    # 炒制
    炒蒜 = 菜.处理([蒜], 煎炒.炒(10, "爆香"), "炒蒜")
    炒土豆_ = 菜.处理([土豆块], 煎炒.炒(30, "用油炒"), "炒土豆")

    # 调味
    最终 = 菜.处理([炒土豆_], 调味.加调料(["盐"]), "调味炒土豆")

    # 炖制
    炖土豆 = 菜.处理([最终], 炖煮.炖(120, "加水炖"), "黑暗炖土豆")

    print("\n烹饪步骤:")
    print(处理器.输出())


def 展示菜谱复用():
    """展示菜谱复用"""
    print("\n" + "=" * 60)
    print("菜谱复用 - 黑暗炖土豆（引用炒土豆）")
    print("=" * 60)

    处理器 = Markdown输出器()
    黑暗炖土豆(处理器)

    print("\n烹饪步骤:")
    print(处理器.输出())


# ============================================================================
# 主函数
# ============================================================================

def main():
    """主函数"""
    print("=" * 60)
    print("菜谱框架 - 完整菜谱示例")
    print("=" * 60)

    # 展示不同风格
    展示装饰器风格()
    展示上下文风格()
    展示操作符风格()
    展示菜谱复用()

    print("\n" + "=" * 60)
    print("所有示例运行完成！")
    print("=" * 60)

    print("\n框架特性总结:")
    print("✅ 装饰器风格 - 使用 @定义菜谱 装饰器")
    print("✅ 上下文管理器 - 使用 with 菜谱上下文")
    print("✅ 操作符重载 - 使用 >> 和 + 操作符")
    print("✅ 菜谱复用 - 使用 菜.引用() 复用已定义菜谱")
    print("✅ 组合处理器 - 同时生成多种输出")
    print("✅ 中文命名 - 更符合项目需求")
    print("✅ 类型安全 - 完整的类型注解")
    print("✅ 流畅API - 链式调用和便利方法")


if __name__ == "__main__":
    main()
