"""
基础示例 - 展示菜谱框架的基本用法
"""

import sys
import os

# 添加父目录到路径以导入框架
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from 菜谱框架 import *


# ============================================================================
# 示例1: 使用装饰器定义菜谱（推荐）
# ============================================================================

@定义菜谱("意大利肉酱")
def 意大利肉酱(菜: 菜谱构建器):
    """
    意大利肉酱 - 使用装饰器风格
    """
    芹菜段 = 菜.切(菜.取食材("芹菜", 根(1)), "段")
    猪肉碎 = 菜.切(菜.取食材("猪肉", 克(600)), "碎")
    洋葱丁 = 菜.切(菜.取食材("洋葱", 个(1)), "碎")
    番茄酱 = 菜.取食材("番茄酱", 克(100))

    return 菜.混合([芹菜段, 猪肉碎, 洋葱丁, 番茄酱],
                  "混合，下锅翻炒一分钟",
                  "意大利肉酱")


@定义菜谱("意大利肉酱三明治")
def 意大利肉酱三明治(菜: 菜谱构建器):
    """
    意大利肉酱三明治 - 展示菜谱复用
    """
    面包片 = 菜.取食材("面包片", 片(2))
    # 使用引用来复用已定义的菜谱
    肉酱 = 菜.引用("意大利肉酱")

    return 菜.组合([面包片, 肉酱], "夹在一起", "意大利肉酱三明治")


# ============================================================================
# 示例2: 使用上下文管理器
# ============================================================================

def 使用上下文管理器():
    """使用上下文管理器定义菜谱"""
    print("\n=== 示例2: 使用上下文管理器 ===")

    with 菜谱上下文(Markdown输出器()) as 菜:
        # 准备食材
        土豆块 = 菜.切(菜.取食材("土豆", 克(500)), "块")
        油 = 菜.取食材("油", 克(20))
        盐 = 菜.取食材("盐", 克(3))
        蒜 = 菜.取食材("蒜", 克(5))

        # 炒蒜
        蒜香 = 菜.炒([蒜], 时间_秒=10, 描述="爆香", 用油=5)

        # 炒土豆
        主菜 = 菜.炒([土豆块], 时间_秒=30, 用油=15)

        # 加盐调味
        最终菜品 = 菜.调味([主菜], ["盐"], "炒土豆")

    # 获取处理器并输出
    处理器 = 菜.处理器
    if hasattr(处理器, '输出'):
        print(处理器.输出())


# ============================================================================
# 示例3: 使用操作符重载
# ============================================================================

def 使用操作符重载():
    """使用操作符重载定义菜谱"""
    print("\n=== 示例3: 使用操作符重载 ===")

    处理器 = Markdown输出器()
    菜 = 菜谱构建器(处理器)

    # 使用 >> 操作符表示处理流程
    芹菜段 = 菜.取食材("芹菜", 根(1)) >> 切("段")
    猪肉碎 = 菜.取食材("猪肉", 克(600)) >> 切("碎")
    洋葱丁 = 菜.取食材("洋葱", 个(1)) >> 切("碎")
    番茄酱 = 菜.取食材("番茄酱", 克(100))

    # 使用 + 表示混合
    肉酱 = (芹菜段 + 猪肉碎 + 洋葱丁 + 番茄酱) >> 混合("混合，下锅翻炒一分钟")

    # 处理组件以生成操作步骤
    菜.处理(
        [芹菜段, 猪肉碎, 洋葱丁, 番茄酱],
        混合操作.混合("混合，下锅翻炒一分钟"),
        "意大利肉酱"
    )

    print(处理器.输出())


# ============================================================================
# 示例4: 使用链式调用
# ============================================================================

def 使用链式调用():
    """使用链式调用"""
    print("\n=== 示例4: 使用链式调用 ===")

    处理器 = Markdown输出器()
    菜 = 菜谱构建器(处理器)

    # 使用包装器支持链式调用
    土豆 = 菜.包装(菜.取食材("土豆", 克(500)))
    土豆块 = 土豆.切("块", "土豆块").组件

    油 = 菜.取食材("油", 克(20))
    盐 = 菜.取食材("盐", 克(3))

    炒土豆 = 菜.炒([土豆块], 时间_秒=30, 用油=20, 名称="炒土豆")

    print(处理器.输出())


# ============================================================================
# 示例5: 组合处理器 - 同时生成多种输出
# ============================================================================

def 使用组合处理器():
    """使用组合处理器"""
    print("\n=== 示例5: 组合处理器 ===")

    markdown_处理器 = Markdown输出器()
    stats_处理器 = 统计分析器()
    组合 = 组合处理器([markdown_处理器, stats_处理器])

    # 执行菜谱
    意大利肉酱三明治(组合)

    # 输出Markdown步骤
    print("\n生成的步骤:")
    print(markdown_处理器.输出())

    # 输出统计信息
    print("\n" + stats_处理器.输出())


# ============================================================================
# 主函数
# ============================================================================

def main():
    """主函数"""
    print("=" * 60)
    print("菜谱框架 - 基础示例")
    print("=" * 60)

    # 示例1: 使用装饰器
    print("\n=== 示例1: 使用装饰器定义菜谱 ===")
    处理器 = Markdown输出器()
    意大利肉酱三明治(处理器)
    print(处理器.输出())

    # 示例2: 使用上下文管理器
    使用上下文管理器()

    # 示例3: 使用操作符重载
    使用操作符重载()

    # 示例4: 使用链式调用
    使用链式调用()

    # 示例5: 组合处理器
    使用组合处理器()

    print("\n" + "=" * 60)
    print("所有示例运行完成！")
    print("=" * 60)


if __name__ == "__main__":
    main()
